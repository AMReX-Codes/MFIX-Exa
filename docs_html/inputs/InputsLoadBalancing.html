<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gridding and Load Balancing &mdash; MFIX-Exa  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Multigrid Inputs" href="InputsMultigrid.html" />
    <link rel="prev" title="Initialization" href="InputsInitialization.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            MFIX-Exa
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User guide:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../GettingStarted_Chapter.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../Inputs_Chapter.html">Run-time Inputs</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="InputsProblemDefinition.html">Problem Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="InputsCoupling.html">Interphase Coupling</a></li>
<li class="toctree-l2"><a class="reference internal" href="InputsTimeStepping.html">Time Stepping</a></li>
<li class="toctree-l2"><a class="reference internal" href="InputsDiscretization.html">Discretization</a></li>
<li class="toctree-l2"><a class="reference internal" href="InputsInitialization.html">Initialization</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Gridding and Load Balancing</a></li>
<li class="toctree-l2"><a class="reference internal" href="InputsMultigrid.html">Multigrid Inputs</a></li>
<li class="toctree-l2"><a class="reference internal" href="InputsHypre.html">Hypre Inputs</a></li>
<li class="toctree-l2"><a class="reference internal" href="InputsPlotFiles.html">Plotfiles and Other Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="InputsCheckpoint.html">Checkpoint/Restart</a></li>
<li class="toctree-l2"><a class="reference internal" href="InputsMonitors.html">Spatial averages</a></li>
<li class="toctree-l2"><a class="reference internal" href="InputsMonitors.html#monitors">Monitors</a></li>
<li class="toctree-l2"><a class="reference internal" href="InputsPICtoDEM.html">PIC to DEM conversion</a></li>
<li class="toctree-l2"><a class="reference internal" href="InputsVerbosity.html">Verbosity</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ManagingGridHierarchy_Chapter.html">Gridding and Load Balancing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Fluids_Chapter.html">Solving the Fluid Equations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Particles_Chapter.html">Particles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../EB_Chapter.html">Embedded Boundaries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Debugging.html">Debugging</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tests and Benchmarks:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../RunningTestSuite.html">Running the MFIX-Exa Test Suite</a></li>
<li class="toctree-l1"><a class="reference internal" href="../RegressionTesting.html">Regression testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CITests.html">Continuous Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../NightlyTests.html">Nightly Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../qb/index.html">Qualitative Benchmarks</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MFIX-Exa</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../Inputs_Chapter.html">Run-time Inputs</a></li>
      <li class="breadcrumb-item active">Gridding and Load Balancing</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/inputs/InputsLoadBalancing.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="gridding-and-load-balancing">
<span id="chap-inputsloadbalancing"></span><h1>Gridding and Load Balancing<a class="headerlink" href="#gridding-and-load-balancing" title="Link to this heading"></a></h1>
<p>The following inputs must be preceded by “amr.” and determine how we create the grids.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>max_grid_size_x</p></td>
<td><p>Maximum number of cells at level 0 in each grid in x-direction</p></td>
<td><p>Int</p></td>
<td><p>32</p></td>
</tr>
<tr class="row-odd"><td><p>max_grid_size_y</p></td>
<td><p>Maximum number of cells at level 0 in each grid in y-direction</p></td>
<td><p>Int</p></td>
<td><p>32</p></td>
</tr>
<tr class="row-even"><td><p>max_grid_size_z</p></td>
<td><p>Maximum number of cells at level 0 in each grid in z-direction</p></td>
<td><p>Int</p></td>
<td><p>32</p></td>
</tr>
<tr class="row-odd"><td><p>blocking_factor_x</p></td>
<td><p>Each grid must be divisible by blocking_factor_x in x-direction</p></td>
<td><p>Int</p></td>
<td><p>8</p></td>
</tr>
<tr class="row-even"><td><p>blocking_factor_y</p></td>
<td><p>Each grid must be divisible by blocking_factor_y in y-direction</p></td>
<td><p>Int</p></td>
<td><p>8</p></td>
</tr>
<tr class="row-odd"><td><p>blocking_factor_z</p></td>
<td><p>Each grid must be divisible by blocking_factor_z in z-direction</p></td>
<td><p>Int</p></td>
<td><p>8</p></td>
</tr>
</tbody>
</table>
<p>The following inputs must be preceded by “mfix.” and determine how often we regrid.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>regrid_int</p></td>
<td><p>How often to regrid (in number of steps at level 0)
if regrid_int = -1 then no regridding will occur</p></td>
<td><p>Int</p></td>
<td><p>-1</p></td>
</tr>
</tbody>
</table>
<p>The following inputs must be preceded by “fabarray_mfiter.” and determine how we create the logical tiles:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>tile_size</p></td>
<td><dl class="simple">
<dt>Maximum number of cells in each direction for (logical) tiles</dt><dd><p>(3D CPU-only)</p>
</dd>
</dl>
</td>
<td><p>IntVect</p></td>
<td><p>1024000
1024000,8,8</p></td>
</tr>
</tbody>
</table>
<p>The following inputs must be preceded by “particles.”</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>max_grid_size_x</p></td>
<td><p>Maximum number of cells at level 0 in each grid in x-direction
for grids in the ParticleBoxArray if dual_grid is true</p></td>
<td><p>Int</p></td>
<td><p>32</p></td>
</tr>
<tr class="row-odd"><td><p>max_grid_size_y</p></td>
<td><p>Maximum number of cells at level 0 in each grid in y-direction
for grids in the ParticleBoxArray if dual_grid is true</p></td>
<td><p>Int</p></td>
<td><p>32</p></td>
</tr>
<tr class="row-even"><td><p>max_grid_size_z</p></td>
<td><p>Maximum number of cells at level 0 in each grid in z-direction
for grids in the ParticleBoxArray if dual_grid is true.</p></td>
<td><p>Int</p></td>
<td><p>32</p></td>
</tr>
<tr class="row-odd"><td><p>tile_size</p></td>
<td><p>Maximum number of cells in each direction for (logical) tiles
in the ParticleBoxArray if dual_grid is true.</p></td>
<td><p>IntVect</p></td>
<td><p>1024000,8,8</p></td>
</tr>
<tr class="row-even"><td><p>reduceGhostParticles</p></td>
<td><p>Remove unused ghost particles from communication,
only supported by GPU build</p></td>
<td><p>Bool</p></td>
<td><p>True</p></td>
</tr>
</tbody>
</table>
<p>Note that when running a granular simulation, i.e., no fluid phase, <code class="code highlight cpp c++ docutils literal highlight-c++"><span class="n">mfix</span><span class="p">.</span><span class="n">dual_grid</span></code> must be 0. Hence,
the <code class="code highlight cpp c++ docutils literal highlight-c++"><span class="n">particles</span><span class="p">.</span><span class="n">max_grid_size</span></code> (in each direction) have no meaning. Therefore the fluid grid and tile
sizes should be set for particle load balancing. It may also be necessary to set the blocking factors to 1.</p>
<p>The following inputs must be preceded by “mfix.” and determine how we load balance:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>dual_grid</p></td>
<td><p>If true then use the “dual_grid” approach for load balancing</p></td>
<td><p>Bool</p></td>
<td><p>False</p></td>
</tr>
<tr class="row-odd"><td><p>load_balance_fluid</p></td>
<td><p>Only relevant if (dual_grid); if so do we also regrid mesh data</p></td>
<td><p>Int</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-even"><td><p>load_balance_type</p></td>
<td><p>What strategy to use for load balancing
Options are “KnapSack”, “SFC”, or “Greedy”</p></td>
<td><p>String</p></td>
<td><p>KnapSack</p></td>
</tr>
<tr class="row-odd"><td><p>knapsack_weight_type</p></td>
<td><p>What weighting function to use if using Knapsack load balancing
Options are “RunTimeCosts” or “NumParticles””</p></td>
<td><p>String</p></td>
<td><p>RunTimeCosts</p></td>
</tr>
<tr class="row-even"><td><p>knapsack_nmax</p></td>
<td><p>Maximum number of grids per MPI process if using knapsack algorithm</p></td>
<td><p>Int</p></td>
<td><p>128</p></td>
</tr>
<tr class="row-odd"><td><p>greedy_dir</p></td>
<td><p>The direction in which the greedy algorithm cuts overloaded boxes</p></td>
<td><p>Int</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-even"><td><p>greedy_min_grid_size</p></td>
<td><p>The minimum particle grid size in the greedy load balance algorithm</p></td>
<td><p>Int</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-odd"><td><p>greedy_3d</p></td>
<td><p>Partition particle grids in 3D with the greedy algorithhm</p></td>
<td><p>Bool</p></td>
<td><p>False</p></td>
</tr>
<tr class="row-even"><td><p>overload_tolerance*</p></td>
<td><p>The ratio between the maximum workload and the average workload
in the greedy algorithm</p></td>
<td><p>Real</p></td>
<td><p>1.2</p></td>
</tr>
<tr class="row-odd"><td><p>underload_tolerance*</p></td>
<td><p>The ratio between the minimum workload and the average workload
in the greedy algorithm</p></td>
<td><p>Real</p></td>
<td><p>0.8</p></td>
</tr>
<tr class="row-even"><td><p>grid_pruning</p></td>
<td><p>Remove all covered grids from the base mesh; this may result in
disjoined grids</p></td>
<td><p>Bool</p></td>
<td><p>False</p></td>
</tr>
</tbody>
</table>
<p>* The greedy partitioning algorithm uses the tolerances to set the expected
workload range for each rank but doesn’t strictly enforce them. The algorithm
creates a partition as balance as possible even if the partition doesn’t
meet the tolerances.</p>
<p>To allow a user to verify the breakdown of fluid grids created before running a full simulation, an input option,
<code class="code highlight cpp c++ docutils literal highlight-c++"><span class="n">mfix</span><span class="p">.</span><span class="n">only_print_grid_report</span></code> is supported. By default, it is <code class="code highlight cpp c++ docutils literal highlight-c++"><span class="n">False</span></code>. When set to <code class="code highlight cpp c++ docutils literal highlight-c++"><span class="n">True</span></code>, the run uses
minimal memory to print the grid coverage report and exits immediately after that.</p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="InputsInitialization.html" class="btn btn-neutral float-left" title="Initialization" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="InputsMultigrid.html" class="btn btn-neutral float-right" title="Multigrid Inputs" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017-2018, MFIX-Exa Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>